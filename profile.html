<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Profile</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>

<body>
  <!-- NAVBAR (UNCHANGED) -->
  <nav class="navbar">
    <div class="container nav-wrapper">
      <a href="index.html" class="logo"><i class="fas fa-code"></i> BhaveshRao</a>

      <button class="hamburger" id="hamburger">
        <span></span><span></span><span></span>
      </button>

      <ul class="nav-menu" id="navMenu">
        <li><a href="index.html">Home</a></li>
        <li><a href="courses.html">Courses</a></li>
        <li><a href="tutorials.html">Tutorials</a></li>
        <li><a href="games.html">Games</a></li>
        <li><a href="notes.html">Notes</a></li>
        <li><a href="blog.html">Blog</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><button id="theme-toggle" class="theme-toggle"><i class="fas fa-moon"></i></button></li>
        <li><button onclick="logout()" class="btn btn-login">Logout</button></li>
      </ul>
    </div>
  </nav>

  <!-- HEADER -->
  <section class="page-header">
    <h1>Your Profile</h1>
    <p>Manage your personal information & account details</p>
  </section>

  <section class="page-content">
    <div class="sidebar-layout">
      <!-- Left Sidebar -->
      <aside class="sidebar">
        <h3>ðŸ‘¤ Account</h3>
        <ul>
          <li><a href="#">Profile Info</a></li>
          <li><a href="#">Security</a></li>
          <li><a href="#">Learning History</a></li>
          <li><a href="#" onclick="logout()">Logout</a></li>
        </ul>
      </aside>

      <!-- Main Card -->
      <main class="main-content">
        <center style="margin-bottom: 25px;">
          <img id="imgPreview" class="profile-pic"
            src="https://cdn-icons-png.flaticon.com/512/149/149071.png"
            style="width: 140px; height: 140px; border-radius:100%; object-fit:cover; box-shadow:0 0 10px rgba(0,0,0,0.2);" />
          <br /><br />
          <label class="btn btn-secondary" style="cursor:pointer;">
            Upload Photo
            <input type="file" id="imgInput" accept="image/*" style="display:none;" />
          </label>
        </center>

        <div class="form-group">
          <label>Name</label>
          <input id="name" class="form-control" />
        </div>

        <div class="form-group">
          <label>Email</label>
          <input id="email" class="form-control" disabled />
        </div>

        <div class="form-group">
          <label>Date of Birth</label>
          <input id="dob" type="date" class="form-control" />
        </div>

        <div class="form-group">
          <label>Phone</label>
          <input id="phone" class="form-control" />
        </div>

        <div class="form-group">
          <label>Address</label>
          <textarea id="address" class="form-control"></textarea>
        </div>

        <button onclick="saveProfile()" class="btn btn-primary btn-large" style="width:100%;">Save Changes</button>
      </main>
    </div>
  </section>

  <script>
   const BASE_URL = "https://bhavesh-backend.onrender.com";

    const token = localStorage.getItem("token");

    if (!token) window.location.replace("login.html");

    window.onload = async () => {
      try {
        const res = await fetch(`${BASE_URL}/profile/me`, {
          headers: { Authorization: "Bearer " + token },
        });
        const data = await res.json();

        document.getElementById("name").value = data.name;
        document.getElementById("email").value = data.email;
        document.getElementById("dob").value = data.dob || "";
        document.getElementById("phone").value = data.phone || "";
        document.getElementById("address").value = data.address || "";
        if (data.profilePic) document.getElementById("imgPreview").src = data.profilePic;
      } catch {
        localStorage.clear();
        window.location.replace("login.html");
      }
    };

    document.getElementById("imgInput").onchange = (e) => {
      let reader = new FileReader();
      reader.onload = () => (document.getElementById("imgPreview").src = reader.result);
      reader.readAsDataURL(e.target.files[0]);
    };

    async function saveProfile() {
      const body = {
        name: document.getElementById("name").value,
        dob: document.getElementById("dob").value,
        phone: document.getElementById("phone").value,
        address: document.getElementById("address").value,
        profilePic: document.getElementById("imgPreview").src,
      };

      const res = await fetch(`${BASE_URL}/profile/update`, {
        method: "PUT",
        headers: { "Content-Type": "application/json", Authorization: "Bearer " + token },
        body: JSON.stringify(body),
      });

      alert("Profile Updated Successfully!");
    }

    function logout() {
      localStorage.clear();
      window.location.replace("login.html");
    }
  </script>
</body>
</html>

