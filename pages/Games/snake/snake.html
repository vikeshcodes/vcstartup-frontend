<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Snake ‚Äî Classic</title>
<style>
  :root{--bg:#081229;--panel:#0f1f33;--accent:#ffd54f}
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--bg),#04213a);font-family:Inter,system-ui,Arial;color:#fff}
  .wrap{width:94vw;max-width:640px;padding:14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px}
  h1{margin:0 0 8px;font-size:1.2rem;text-align:center}
  #board{display:block;margin:0 auto;background:linear-gradient(180deg,#063048,#083a55);border-radius:10px;touch-action:none}
  #info{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
  button{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;color:#222;font-weight:700;cursor:pointer}
  .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:20}
  .panel{background:#062536;padding:20px;border-radius:12px;text-align:center}
  .small{font-size:.9rem;opacity:.9}
  @media (max-width:480px){h1{font-size:1rem}}
</style>
</head>
<body>
<div class="wrap">
  <h1>üêç Snake ‚Äî Arrow keys / Swipe to play</h1>
  <canvas id="board" width="600" height="600"></canvas>
  <div id="info">
    <div>Score: <span id="score">0</span> ‚Ä¢ High: <span id="high">0</span></div>
    <div>
      <button id="start">Start</button>
      <button id="pause">Pause</button>
      <button id="restart">Restart</button>
    </div>
  </div>
  <p class="small">Use arrow keys or swipe on mobile. Eat food to grow; avoid hitting walls / yourself.</p>
</div>

<div id="gameOver" class="overlay" role="dialog" aria-modal="true">
  <div class="panel">
    <h2 id="goText">Game Over</h2>
    <p id="goScore">Score: 0</p>
    <button id="goRestart">Play Again</button>
  </div>
</div>

<script>
(() => {
  const canvas = document.getElementById('board');
  const ctx = canvas.getContext('2d');
  const startBtn = document.getElementById('start');
  const pauseBtn = document.getElementById('pause');
  const restartBtn = document.getElementById('restart');
  const scoreEl = document.getElementById('score');
  const highEl = document.getElementById('high');
  const overlay = document.getElementById('gameOver');
  const goScore = document.getElementById('goScore');
  const goRestart = document.getElementById('goRestart');

  const gridCount = 20; // 20x20 grid
  let cellSize = Math.floor(canvas.width / gridCount);
  let snake, dir, nextDir, food, running, gameLoopId, speed, score, high;

  // load highscore
  high = parseInt(localStorage.getItem('snake_high') || '0', 10);
  highEl.textContent = high;

  function reset() {
    // adapt cell size if canvas resized
    cellSize = Math.floor(canvas.width / gridCount);
    snake = [{x:10,y:10},{x:9,y:10},{x:8,y:10}]; // head at index 0
    dir = {x:1,y:0}; nextDir = dir;
    spawnFood();
    score = 0; scoreEl.textContent = score;
    speed = 8; // frames per second
    running = false;
    draw();
  }

  function spawnFood(){
    while(true){
      const x = Math.floor(Math.random()*gridCount);
      const y = Math.floor(Math.random()*gridCount);
      if(!snake.some(s=>s.x===x && s.y===y)){ food = {x,y}; break;}
    }
  }

  function drawCell(x,y,color,stroke=false){
    ctx.fillStyle = color; ctx.fillRect(x*cellSize+1, y*cellSize+1, cellSize-2, cellSize-2);
    if(stroke){ ctx.strokeStyle = 'rgba(0,0,0,0.25)'; ctx.strokeRect(x*cellSize+1, y*cellSize+1, cellSize-2, cellSize-2); }
  }

  function draw(){
    // background
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // grid background
    ctx.fillStyle = '#061b26'; ctx.fillRect(0,0,canvas.width,canvas.height);
    // draw food
    drawCell(food.x, food.y, '#ff4d4d');
    // draw snake
    snake.forEach((s,i)=>{
      drawCell(s.x, s.y, i===0 ? '#ffd54f' : '#ffb74d', true);
    });
  }

  function step(){
    // apply nextDir (prevent reversing)
    if(!(nextDir.x === -dir.x && nextDir.y === -dir.y)) dir = nextDir;
    const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
    // wall collision
    if(head.x < 0 || head.x >= gridCount || head.y < 0 || head.y >= gridCount){ endGame(); return; }
    // self collision
    if(snake.some(s => s.x === head.x && s.y === head.y)){ endGame(); return; }
    snake.unshift(head);
    // food?
    if(head.x === food.x && head.y === food.y){
      score += 10; scoreEl.textContent = score; spawnFood();
      // increase speed up to a limit
      if(score % 50 === 0) speed = Math.min(18, speed + 1);
    } else {
      snake.pop();
    }
    draw();
  }

  let lastTime = 0;
  function loop(timestamp){
    if(!running) return;
    const interval = 1000 / speed;
    if(timestamp - lastTime >= interval){
      step();
      lastTime = timestamp;
    }
    gameLoopId = requestAnimationFrame(loop);
  }

  function start(){
    if(running) return;
    running = true;
    lastTime = performance.now();
    gameLoopId = requestAnimationFrame(loop);
  }

  function pause(){
    running = false;
    if(gameLoopId) cancelAnimationFrame(gameLoopId);
  }

  function endGame(){
    pause();
    overlay.style.display = 'flex';
    goScore.textContent = `Score: ${score}`;
    if(score > high){ high = score; localStorage.setItem('snake_high', high); highEl.textContent = high; }
  }

  // controls
  document.addEventListener('keydown', e => {
    if(e.key === 'ArrowUp') nextDir = {x:0,y:-1};
    if(e.key === 'ArrowDown') nextDir = {x:0,y:1};
    if(e.key === 'ArrowLeft') nextDir = {x:-1,y:0};
    if(e.key === 'ArrowRight') nextDir = {x:1,y:0};
    if(e.key === ' '){ if(running) pause(); else start();}
  });

  // touch swipe support
  let touchStart = null;
  canvas.addEventListener('touchstart', e => {
    const t = e.touches[0]; touchStart = {x: t.clientX, y: t.clientY};
  }, {passive:true});
  canvas.addEventListener('touchend', e => {
    if(!touchStart) return;
    const t = e.changedTouches[0]; const dx = t.clientX - touchStart.x, dy = t.clientY - touchStart.y;
    if(Math.abs(dx) > Math.abs(dy)){
      if(dx > 20) nextDir = {x:1,y:0}; else if(dx < -20) nextDir = {x:-1,y:0};
    } else {
      if(dy > 20) nextDir = {x:0,y:1}; else if(dy < -20) nextDir = {x:0,y:-1};
    }
    touchStart = null;
  }, {passive:true});

  // buttons
  startBtn.addEventListener('click', ()=>{ start(); });
  pauseBtn.addEventListener('click', ()=>{ if(running) pause(); else start(); });
  restartBtn.addEventListener('click', ()=>{ overlay.style.display='none'; reset(); start(); });
  goRestart.addEventListener('click', ()=>{ overlay.style.display='none'; reset(); start(); });

  // responsive canvas
  function resize(){
    const size = Math.min(window.innerWidth * 0.9, 640);
    canvas.width = canvas.height = Math.floor(size);
    cellSize = Math.floor(canvas.width / gridCount);
    draw();
  }
  window.addEventListener('resize', resize);

  // init
  resize();
  reset();
})();
</script>
</body>
</html>
